# Install the HIC CA certificate
@"
-----BEGIN CERTIFICATE-----
MIIG0jCCBLqgAwIBAgIUSG5U78ew7zWqsiFJSPbTeJwhdHcwDQYJKoZIhvcNAQEF
BQAwgZMxCzAJBgNVBAYTAkdCMT4wPAYDVQQKDDVIZWFsdGggSW5mb3JtYXRpY3Mg
Q2VudHJlIChISUMpLCBVbml2ZXJzaXR5IG9mIER1bmRlZTEdMBsGA1UEAwwUaGlj
LXRyZS5kdW5kZWUuYWMudWsxJTAjBgkqhkiG9w0BCQEWFmhpYy1pbmZyYUBkdW5k
ZWUuYWMudWswHhcNMjQwODA3MDk1MDE3WhcNMzQwODA1MDk1MDE3WjCBkzELMAkG
A1UEBhMCR0IxPjA8BgNVBAoMNUhlYWx0aCBJbmZvcm1hdGljcyBDZW50cmUgKEhJ
QyksIFVuaXZlcnNpdHkgb2YgRHVuZGVlMR0wGwYDVQQDDBRoaWMtdHJlLmR1bmRl
ZS5hYy51azElMCMGCSqGSIb3DQEJARYWaGljLWluZnJhQGR1bmRlZS5hYy51azCC
AiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAKxxRuVIzKkAMy9VlW4nBm5d
aqiMIn4+cF7fVxFN0vM4UGSB6WQ+xJ8MaIMtLzDkcC4sagB67WUjVhrLzY4Wv1Tj
vNMIPhg8PUfOFiV9Ff+vB4KN2J1dIHSSib1NuO/Wvr13prc0G02uVDPGEhJKcd8d
C2HUC9xyRFUC45KtpRqjYzBBSBmpLnGHO8qhQKLnN/Y6lbYuGqqEPVCrt1nL9TYy
CwNk67XXd9KtZgFmsNbmVpYOVpiMzowEyZGatil75v3IvcinLqH0mgpVUreINGUY
aDbGLLv0lLXEktihYau27D5PhKjqjIiMtYSf/PsLdmuUdzQ0D0VRctBCupWqqiUX
JgDHCVQ4aupcz03k15pciV3nkBSVcN7MyhbWWbX3fwPIHP8udRAlTB+tvqJi82r5
PhfyBdZ+/0JmsHUA/SJOXvTWqlaPVitUnTpxK5rUccZVKxaLPd8ZmTGYS3KSx/1m
InbGPLJtfnlhaT3LoVFng7jNwgQlMeOFruhKVvnb96uw5M5lva4uPNmjD7cFN185
H+t2wE2EWdYWcx9X1i63DuXE+t9b0bz8mXEeB8R3KX7fRXjMj2KqUCgEjZNJxBh3
ABeZDif/cg3v54ycpgH+/147N7/oBPykuhPgfHsfpbq+riMvtm8ire8oBXyk/aWI
huIlXWSZF2LQ7i/GsRX5AgMBAAGjggEaMIIBFjAPBgNVHRMBAf8EBTADAQH/MB0G
A1UdDgQWBBRrrQ5I7/TGnNetJktvWUTV7nDMDDCB0wYDVR0jBIHLMIHIgBRrrQ5I
7/TGnNetJktvWUTV7nDMDKGBmaSBljCBkzELMAkGA1UEBhMCR0IxPjA8BgNVBAoM
NUhlYWx0aCBJbmZvcm1hdGljcyBDZW50cmUgKEhJQyksIFVuaXZlcnNpdHkgb2Yg
RHVuZGVlMR0wGwYDVQQDDBRoaWMtdHJlLmR1bmRlZS5hYy51azElMCMGCSqGSIb3
DQEJARYWaGljLWluZnJhQGR1bmRlZS5hYy51a4IUSG5U78ew7zWqsiFJSPbTeJwh
dHcwDgYDVR0PAQH/BAQDAgGGMA0GCSqGSIb3DQEBBQUAA4ICAQAsRo15QQbLyaIv
w3B7x5HHDdTkMYJ3SbGWasOaYn6GmoH1borKFeITa/LkhIviLmxodcswWSBxVy0G
HtJuDipPwG0thi2FxuydgNGIsRL5nq2ctMJQ++klrpOCANGVQLHfqz68xvqR+19e
MEApWppAvg68FoXREIKO+SRma7FrTif1rGrWXxHJcDUlgjKoNFzCbFAK4nb5ueFn
D5MHfYg4QWo5Tq//kBuWNLV/4Dtdwyp3OWOeFBXqkjYS4JKLrgUgyqCmlI8Tn7gv
CjTlAj8uWrOpc170MaU+FuV2/PyrXOF0izFc1UIZ0A5mP1HKNqU9P40Kmk9Ova2C
BOoiKXVJQgUffvTPZSiWhDDXwGPYrGcbz2WuEeZIZxQ0xQajMkPrtxRtKh66w6Nk
yIR9SdOE4swSortTixwqBCp7MXNvMuJ/lsudan1ITt+guVe4BfZqLxEfpQy3VxX9
oQSmSa3K8S0+/7jNK2gRl1o11PtcsBIi7nHUVUE1IrWkH3x0XE+e+VkSQ8IyNgg/
zvyXRCnDutC2I48pjubDIKtp2crIOMdsmtBVCQq6gX1Sl/4z4E6BXEWkfVcSBk+O
05i6skiAX2QQcqX+EC/9HQ8UEjKIGeXyR2SxAiACx+1ckj9MHG8nytRAJQ2glmLs
ws7bgq7KAqJqvvPyVIeOW0hx4AX+5Q==
-----END CERTIFICATE-----
"@ | Out-File -Encoding ASCII -FilePath C:\Tools\hic-tre.dundee.ac.uk.crt

Get-Item C:\Tools\hic-tre.dundee.ac.uk.crt | `
  Import-Certificate -CertStoreLocation Cert:\LocalMachine\Root


# Firefox doesn't use the system certificates by default, but a policy
# can be used to force the installation of the certificate at the next
# run.
New-Item -Path "C:\Program Files\Mozilla Firefox\" -Name distribution -ItemType Directory -Force
@"
{
  "policies": {
    "Certificates": {
      "Install": ["C:\\Tools\\hic-tre.dundee.ac.uk.crt"]
    }
  }
}
"@ | Out-File -Encoding ASCII -FilePath "C:\Program Files\Mozilla Firefox\distribution\policies.json"

# This covers both conda and CRAN, but it also overrides their own
# provided CA chain files. That's probably ok given we don't allow
# access to the internet.
# [Environment]::SetEnvironmentVariable(
#     "SSL_CERT_FILE",
#     "C:\Tools\hic-tre.dundee.ac.uk.crt",
#     [System.EnvironmentVariableTarget]::User)
# [Environment]::SetEnvironmentVariable(
#     "REQUESTS_CA_BUNDLE",
#     "C:\Tools\hic-tre.dundee.ac.uk.crt",
#     [System.EnvironmentVariableTarget]::User)
# [Environment]::SetEnvironmentVariable(
#     "CURL_CA_BUNDLE",
#     "C:\Tools\hic-tre.dundee.ac.uk.crt",
#     [System.EnvironmentVariableTarget]::User)
